<?php

	include "util.php";
	require_once('../bdd.php');
	
	// DB connection
	$db = new bdd("SAMUEL-PC","bdd_user","user_bdd","ping2");
	$conn = $db->getConn();
	
	// get optionMachine
	$jsonOptionMachine = $_GET['jsonOptionMachine'];
	$data = json_decode(json_encode($jsonOptionMachine),true);
	
	// make optionMachine as array
	$listMachine = array();
	$listOption = array();
	$data = str_replace("\"","",$data);
	$data = substr($data, 1, strlen($data)-2);
	$maps = explode(",",$data);
	foreach($maps as $map){
		$keyValue = explode(":",$map);
		$machine = $keyValue[0];
		$option = $keyValue[1];
		array_push($listMachine,$machine);
		array_push($listOption,$option);
	}
	$optionMachine = array_combine($listMachine, $listOption);
	
	// get data for each machine
	$listGraphPourc = array();
	$listGraphPareto = array();
	foreach($listMachine as $machine){
		$graphPourc = getPourcGraphData($machine);
		$graphPareto = getParetoGraphData($machine, $conn);
		array_push($listGraphPourc, $graphPourc);
		array_push($listGraphPareto, $graphPareto);
	}
	$listMachineGraphPourc = array_combine($listMachine,$listGraphPourc);
	$listMachineGraphPareto = array_combine($listMachine,$listGraphPareto);
	
	echo json_encode($listMachine)."AND".json_encode($optionMachine)."AND".json_encode($listMachineGraphPourc)."AND".json_encode($listMachineGraphPareto);

?>